# Change Stream App

Это Python-приложение для работы с MongoDB Change Streams. Оно отслеживает изменения в коллекциях MongoDB и работает параллельно для нескольких сервисов. Все конфигурационные параметры, включая URI MongoDB, имя базы данных и коллекции для отслеживания, можно настроить через JSON-файл. Приложение можно запускать в Docker и Kubernetes.

## Основные возможности

- Подключение к MongoDB и отслеживание изменений в коллекциях с использованием Change Streams.
- Параллельное отслеживание изменений для нескольких сервисов и коллекций.
- Конфигурация через JSON файл, который можно изменить в Kubernetes (или локально).
- Поддержка Docker для контейнеризации.
- Развертывание в Kubernetes для масштабируемости.

## Установка

Для запуска приложения локально, следуйте этим шагам.

### 1. Установите зависимости

Сначала установите Python-зависимости:

```bash
pip install -r requirements.txt
```

### 2. Запуск приложения локально
Запустите скрипт main.py для отслеживания изменений в MongoDB:

```bash
python main.py
```

### 3. Использование Docker
Для того чтобы собрать Docker-образ, выполните команду:

```bash
docker build -t change-stream-app .
```

После сборки образа, запустите контейнер:

```bash
docker run -d --name change-stream-app change-stream-app
```

### 4. Развертывание в Kubernetes
Для развертывания приложения в Kubernetes:

Примените ConfigMap:

```bash
kubectl apply -f configmap.yaml
```

Примените Deployment:

```bash
kubectl apply -f deployment.yaml
```

Теперь приложение будет запущено в Kubernetes, и оно будет отслеживать изменения в MongoDB согласно настройкам в config.json.

###  Конфигурация
Конфигурация хранится в файле config.json, который содержит информацию о MongoDB и сервисах для отслеживания. Пример:

```json
{
  "mongodb": {
    "uri": "mongodb://localhost:27017",
    "database": "mydatabase"
  },
  "services": [
    {
      "name": "service1",
      "collections": ["collection1", "collection2"]
    },
    {
      "name": "service2",
      "collections": ["collection3", "collection4"]
    }
  ]
}
```

- mongodb.uri — URI для подключения к MongoDB.

- mongodb.database — имя базы данных для подключения.

- services — список сервисов, каждый сервис может отслеживать несколько коллекций.

### Использование
После запуска приложения, оно будет отслеживать изменения в MongoDB для каждой из коллекций, указанных в конфигурации. Приложение будет выводить информацию о любых изменениях в этих коллекциях.

### Параллельная работа
Каждый сервис будет работать в отдельном потоке и отслеживать изменения в указанных коллекциях. Это достигается с помощью ThreadPoolExecutor в Python.
